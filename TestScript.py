import pickle
import base64
import sys
import subprocess
import time

YOUR_BASEPATH = '/Users/zhengwenxin/Documents/Projects/BASIC-Compiler/ut'
VERBOSE = False

def info(s):
    print('[Info] {}'.format(s))

def fatal(s):
    print('[FATAL ERROR] {}'.format(s))
    sys.exit(0)

def judge(testcase):
    build_timeout = 5
    testname, inputctx, retcode, inputcode = testcase
    if VERBOSE:
        print('[Verbose] =======Build Stage START =======')
        process = subprocess.run(['make', 'build'], input=inputcode.encode(), cwd=YOUR_BASEPATH, timeout=build_timeout)
    else:
        process = subprocess.run(['make', 'build'], input=inputcode.encode(), cwd=YOUR_BASEPATH, stdout=subprocess.DEVNULL, stderr=subprocess.DEVNULL, timeout=build_timeout)
    print('[Verbose] =======Build Stage FINISH=======\n') if VERBOSE else None
    
    if process.returncode != 0:
        fatal('Unable to build with build stage exitcode: {}'.format(process.returncode))
    if VERBOSE:
        print('[Verbose] =======Simulation Stage START =======')
        process = subprocess.run(['make', 'simulate'], input=(inputctx + '\n').encode(), cwd=YOUR_BASEPATH, timeout=build_timeout)
    else:
        process = subprocess.run(['make', 'simulate'], input=(inputctx + '\n').encode(), cwd=YOUR_BASEPATH, stdout=subprocess.DEVNULL, stderr=subprocess.DEVNULL, timeout=build_timeout)

    print('[Verbose] =======Simulation Stage FINISH=======\n') if VERBOSE else None

    user_ret = process.returncode
    if user_ret == retcode:
        print('[PASS] {}'.format(testname))
        return True
    else:
        print('[FAIL] {}, std_ret: {}, your_ret: {}'.format(testname, retcode, user_ret))
        return False
    

testdata = "gASVjxkAAAAAAABdlCgojAtiYXNpY18xLnR4dJSMAJRLAIw7MSBSRU0gYmFzaWNfMS50eHQKMiBSRU0gaW5wdXQ6IAozIFJFTSBhc2Zlc2tlamZld2Y0IEVYSVQgMAqUdJQojAtiYXNpY18yLnR4dJSMATWUSwWMRjEgUkVNIGJhc2ljXzIudHh0CjIgUkVNIGlucHV0OiA1CjMgUkVNIGFzZmVza2VqZmV3ZjQgSU5QVVQgYQo1IEVYSVQgYQqUdJQojAtiYXNpY18zLnR4dJSMATSUSwSMUzEgUkVNIGJhc2ljXzMudHh0CjIgUkVNIGlucHV0OiA0CjMgUkVNIGFzZmVza2VqZmV3ZjQgSU5QVVQgaW5wCjUgR09UTyA2CjYgRVhJVCBpbnAKlHSUKIwLYmFzaWNfNC50eHSUjAEylEsDjGAxIFJFTSBiYXNpY180LnR4dCAKMiBSRU0gaW5wdXQ6IDIgCjMgUkVNIGFzZmVza2VqZmV3ZjQgSU5QVVQgdmFyCjUgTEVUIHZhciA9IHZhciArIDEKNiBFWElUIHZhcgqUdJQojAtiYXNpY181LnR4dJRoDksEjGAxIFJFTSBiYXNpY181LnR4dCAKMiBSRU0gaW5wdXQ6IDIgCjMgUkVNIGFzZmVza2VqZmV3ZjQgSU5QVVQgdmFyCjUgTEVUIHZhciA9IHZhciAqIDIKNiBFWElUIHZhcgqUdJQojAtiYXNpY182LnR4dJSMAzUgM5RLBYx0MSBSRU0gYmFzaWNfNi50eHQKMiBSRU0gaW5wdXQ6IDUgMwozIFJFTSBhc2Zlc2tlamZld2Y0IElOUFVUIGEsYgo1IExFVCBjID0gMAo2IElGIGEgPCBiIFRIRU4gOAo3IExFVCBjID0gYQo4IEVYSVQgYwqUdJQojAtiYXNpY183LnR4dJSMAzUgM5RLA4x9MSBSRU0gYmFzaWNfNy50eHQKMiBSRU0gaW5wdXQ6IDUgMwozIFJFTSBhc2Zlc2tlamZld2Y0IElOUFVUIGEsYgo1IElGIGEgPiBiIFRIRU4gOAo2IExFVCBjID0gYQo3IEdPVE8gOQo4IExFVCBjID0gYgo5IEVYSVQgYwqUdJQojAtiYXNpY184LnR4dJRoBksKjJkxIFJFTSBiYXNpY184LnR4dAoyIFJFTSBpbnB1dDogNQozIFJFTSBhc2Zlc2tlamZld2Y0IElOUFVUIG4KNSBMRVQgaSA9IDEKNiBMRVQgc3VtID0gMAo3IEZPUiBpID0gaSArIDE7IGkgPCBuCjggTEVUIHN1bSA9IHN1bSArIGkKOSBFTkQgRk9SCjEwIEVYSVQgc3VtIAqUdJQojAtiYXNpY185LnR4dJRoBksGjLoxIFJFTSBiYXNpY185LnR4dAoyIFJFTSBpbnB1dDogNQozIFJFTSBhc2Zlc2tlamZld2Y0IElOUFVUIG4KNSBMRVQgaSA9IDEKNiBMRVQgc3VtID0gMAo3IEZPUiBpID0gaSArIDE7IGkgPCBuCjggSUYgaSAtIDIgKiAoaSAvIDIpICE9IDAgVEhFTiA3CjkgTEVUIHN1bSA9IHN1bSArIGkKMTAgRU5EIEZPUgoxMSBFWElUIHN1bQqUdJQojAxiYXNpY18xMC50eHSUaAZLHoxgMSBSRU0gYmFzaWNfMTAudHh0CjIgUkVNIGlucHV0OiA1CjMgUkVNIGFzZmVza2VqZmV3ZjQgSU5QVVQgbgo1IExFVCBzdW0gPSBuICogbiArIG4KNiBFWElUIHN1bSAKlHSUKIwNY29udHJvbF8xLnR4dJSMAjEzlE1A7FjtAwAAMSBSRU0gY29udHJvbF8xLnR4dAoyIFJFTSBpbnB1dDogMTMKMyBSRU0gYXNmZXNrZWpmZXdmNCBJTlBVVCBOCjUgTEVUIGggPSA5CjYgTEVUIGkgPSAxMAo3IExFVCBqID0gMTEKOCBMRVQgayA9IDEyCjkgTEVUIHRvdGFsID0gMAoxMCBMRVQgYSA9IDEKMTEgTEVUIGIgPSAxCjEyIExFVCBjID0gMQoxMyBMRVQgZCA9IDEKMTQgTEVUIGUgPSAxCjE1IExFVCBmID0gMQoxNiBGT1IgYSA9IGEgKyAxOyBhIDw9IE4KMTcgIExFVCBiID0gMQoxOCAgRk9SIGIgPSBiICsgMTsgYiA8PSBOCjE5ICBMRVQgYyA9IDEKMjAgICAgRk9SIGMgPSBjICsgMTsgYyA8PSBOCjIxICAgICAgTEVUIGQgPSAxCjIyICAgICAgRk9SIGQgPSBkICsgMTsgZCA8PSBOCjIzICAgICAgICBMRVQgZSA9IDEKMjQgICAgICAgIEZPUiBlID0gZSArIDE7IGUgPD0gTgoyNSAgICAgICAgICBMRVQgZiA9IDEKMjYgICAgICAgICAgRk9SIGYgPSBmICsgMTsgZiA8PSBOCjI3ICAgICAgICAgICAgSUYgKGE9PWIgfHwgYT09YyB8fCAgYT09ZCB8fCAgYT09ZSB8fCAgYT09ZiB8fCAgYT09aCB8fCAgYT09aSB8fCAgYT09aiB8fCAgYT09ayB8fCAgYj09YyB8fCAgYj09ZCB8fCAgYj09ZSB8fCAgYj09ZiB8fCAgYj09aCB8fCAgYj09aSB8fCAgYj09aiB8fCAgYj09ayB8fCAgYz09ZCB8fCAgYz09ZSB8fCAgYz09ZiB8fCAgYz09aCB8fCAgYz09aSB8fCAgYz09aiB8fCAgYz09ayB8fCAgZD09ZSB8fCAgZD09ZiB8fCAgZD09aCB8fCAgZD09aSB8fCAgZD09aiB8fCAgZD09ayB8fCAgZT09ZiB8fCAgZT09aCB8fCAgZT09aSB8fCAgZT09aiB8fCAgZT09ayB8fCAgZj09aCB8fCAgZj09aSB8fCAgZj09aiB8fCAgZj09ayB8fCAgaT09aiB8fCAgaD09aykgVEhFTiAyNAoyOCAgICAgICAgICAgIExFVCB0b3RhbCA9IHRvdGFsICsgMQoyOSAgICAgICAgICBFTkQgRk9SCjMwICAgICAgICBFTkQgRk9SCjMxICAgICAgRU5EIEZPUiAKMzIgICAgRU5EIEZPUgozMyAgRU5EIEZPUgozNCBFTkQgRk9SCjM1IEVYSVQgdG90YWwKlHSUKIwNY29udHJvbF8yLnR4dJSMATaUSwaMczEgUkVNIGNvbnRyb2xfMi50eHQKMiBSRU0gaW5wdXQ6IDYKMyBSRU0gYXNmZXNrZWpmZXdmNSBJTlBVVCBuCjcgSUYgbiA+IDUgVEhFTiAxMQo4IExFVCBuID0gNQoxMCBFWElUIG4KMTEgR09UTyAxMAqUdJQojA1jb250cm9sXzMudHh0lIwEMTAgNZRLAIzkMSBSRU0gY29udHJvbF8zLnR4dAoyIFJFTSBpbnB1dDogMTAgNQozIFJFTSBhc2Zlc2tlamZld2Y0IElOUFVUIG0sbgo1IEZPUiBtID0gbSAtIChtIC8gbikgKiBuOyBuID4gMAo2IElGIG0gPj0gbiBUSEVOIDEwCjcgTEVUIHRtcCA9IG0KOCBMRVQgbSA9IG4KOSBMRVQgbiA9IHRtcAoxMCBJRiBuID09IDAgVEhFTiAxNAoxMSBFTkQgRk9SCjEyIEVYSVQgbQoxNCBMRVQgbiA9IC0xCjE1IEdPVE8gMTEKlHSUKIwNY29udHJvbF80LnR4dJRoBksQWAUBAAAxIFJFTSBjb250cm9sXzQudHh0CjIgUkVNIGlucHV0OiA1CjMgUkVNIGFzZmVza2VqZmV3ZjQgSU5QVVQgbgo1IEdPVE8gOQo2IEdPVE8gMTIKNyBMRVQgbiA9IChuICogOCkgKyBuIC8gNAo4IEdPVE8gMTEKOSBMRVQgbiA9IG4gKiAyICsgMQoxMCBHT1RPIDYKMTEgR09UTyAxNgoxMiBMRVQgbiA9IChuIC0gNikgLyAyIAoxMyBJRiBuID09IDIgVEhFTiA3CjE0IEVYSVQgMjQKMTYgSUYgbiA8PSAxMCBUSEVOIDIxCjIwIEVYSVQgbgoyMSBFWElUIG4gLSAxMAqUdJQojA1jb250cm9sXzUudHh0lGgGSwpYWwEAADEgUkVNIGNvbnRyb2xfNS50eHQKMiBSRU0gaW5wdXQ6IDUKMyBSRU0gYXNmZXNrZWpmZXdmNCBJTlBVVCBuCjUgTEVUIGEgPSAxCjYgTEVUIGIgPSAxCjcgTEVUIGMgPSAxCjggTEVUIGQgPSAxCjkgTEVUIHN1bSA9IDAKMTAgRk9SIGEgPSBhICsgMTsgYSA8PSBuCjExIExFVCBiID0gYQoxMiBGT1IgYiA9IGIgKyAxOyBiIDw9IG4KMTMgTEVUIGMgPSBiCjE0IEZPUiBjID0gYyArIDE7IGMgPD0gbgoxNSAgSUYgYSAhPSBiICYmIGIgIT0gYyAmJiBhICE9IGMgVEhFTiAxNwoxNiAgR09UTyAxOAoxNyAgTEVUIHN1bSA9IHN1bSArIDEKMTggRU5EIEZPUgoxOSBFTkQgRk9SCjIwIEVORCBGT1IKMjEgRVhJVCBzdW0KlHSUKIwIb3BfMS50eHSUjAQ1ICA3lEtDjGIxIFJFTSBvcF8xLnR4dAoyIFJFTSBpbnB1dDogNSAgNwozIFJFTSBhc2Zlc2tlamZld2Y0IElOUFVUIGEsYgo1IExFVCBjID0gKGEgKyBiKSAqIGEgKyBiCjYgRVhJVCBjCpR0lCiMCG9wXzIudHh0lIwDMSAxlEsDWOkFAAAxIFJFTSBvcF8yLnR4dAoyIFJFTSBpbnB1dDogMSAxCjMgUkVNIGFzZmVza2VqZmV3ZjQgSU5QVVQgQQo1IElOUFVUIEIKNiBMRVQgQyA9IDEKNyBMRVQgQSA9ICgoKCgoKCgoQyAtIEEgKyBCKSAtIChBICsgQikpICsgKChDIC0gQSArIEIpIC0gKEEgKyBCKSkpICsgKCgoQyAtIEEgKyBCKSAtIChBICsgQikpICsgKEMgLSBBICsgQikpKSAtICgoKChBICsgQikgKyAoQyAtIEEgKyBCKSkgLSAoQSArIEIpKSArICgoKEMgLSBBICsgQikgLSAoQSArIEIpKSArIChDIC0gQSArIEIpKSkpIC0gKCgoKChBICsgQikgKyAoQyAtIEEgKyBCKSkgLSAoKEEgKyBCKSArIChDIC0gQSArIEIpKSkgLSAoKChBICsgQikgKyAoQyAtIEEgKyBCKSkgLSAoQSArIEIpKSkgKyAoKCgoQyAtIEEgKyBCKSAtIChBICsgQikpICsgKEMgLSBBICsgQikpIC0gKCgoQSArIEIpICsgKEMgLSBBICsgQikpIC0gKEEgKyBCKSkpKSkgKyAoKCgoKChDIC0gQSArIEIpIC0gKEEgKyBCKSkgKyAoKEMgLSBBICsgQikgLSAoQSArIEIpKSkgKyAoKChDIC0gQSArIEIpIC0gKEEgKyBCKSkgKyAoQyAtIEEgKyBCKSkpIC0gKCgoKEEgKyBCKSArIChDIC0gQSArIEIpKSAtIChBICsgQikpICsgKCgoQyAtIEEgKyBCKSAtIChBICsgQikpICsgKEMgLSBBICsgQikpKSkgLSAoKCgoKEEgKyBCKSArIChDIC0gQSArIEIpKSAtIChBICsgQikpICsgKCgoQyAtIEEgKyBCKSAtIChBICsgQikpICsgKEMgLSBBICsgQikpKSAtICgoKChBICsgQikgKyAoQyAtIEEgKyBCKSkgLSAoQSArIEIpKSArICgoKEMgLSBBICsgQikgLSAoQSArIEIpKSArIChDIC0gQSArIEIpKSkpKSkgLSAoKCgoKCgoQSArIEIpICsgKEMgLSBBICsgQikpIC0gKChBICsgQikgKyAoQyAtIEEgKyBCKSkpIC0gKCgoQSArIEIpICsgKEMgLSBBICsgQikpIC0gKEEgKyBCKSkpICsgKCgoKEMgLSBBICsgQikgLSAoQSArIEIpKSArIChDIC0gQSArIEIpKSAtICgoKEEgKyBCKSArIChDIC0gQSArIEIpKSAtIChBICsgQikpKSkgKyAoKCgoKEMgLSBBICsgQikgLSAoQSArIEIpKSArIChDIC0gQSArIEIpKSAtICgoKEEgKyBCKSArIChDIC0gQSArIEIpKSAtIChBICsgQikpKSArICgoKChDIC0gQSArIEIpIC0gKEEgKyBCKSkgKyAoQyAtIEEgKyBCKSkgLSAoKChBICsgQikgKyAoQyAtIEEgKyBCKSkgLSAoQSArIEIpKSkpKSArICgoKCgoKEMgLSBBICsgQikgLSAoQSArIEIpKSArICgoQyAtIEEgKyBCKSAtIChBICsgQikpKSArICgoKEMgLSBBICsgQikgLSAoQSArIEIpKSArIChDIC0gQSArIEIpKSkgLSAoKCgoQSArIEIpICsgKEMgLSBBICsgQikpIC0gKEEgKyBCKSkgKyAoKChDIC0gQSArIEIpIC0gKEEgKyBCKSkgKyAoQyAtIEEgKyBCKSkpKSAtICgoKCgoQSArIEIpICsgKEMgLSBBICsgQikpIC0gKEEgKyBCKSkgKyAoKChDIC0gQSArIEIpIC0gKEEgKyBCKSkgKyAoQyAtIEEgKyBCKSkpIC0gKCgoKEEgKyBCKSArIChDIC0gQSArIEIpKSAtIChBICsgQikpICsgKCgoQyAtIEEgKyBCKSAtIChBICsgQikpICsgKEMgLSBBICsgQikpKSkpKSkKOCBFWElUIEEKlHSUKIwIb3BfMy50eHSUjAM0IDaUSzWMljEgUkVNIG9wXzMudHh0CjIgUkVNIGlucHV0OiA0IDYKMyBSRU0gYXNmZXNrZWpmZXdmNCBJTlBVVCB4LCB5CjUgSUYgKCh4IDwgeSkgJiYgKHggKyA1ID49IHkpKSBUSEVOIDcKNiBMRVQgeCA9IHggKyAyCjcgTEVUIHkgPSB5ICsgMQo4IEVYSVQgeCArIHkgKiB5CpR0lCiMCG9wXzQudHh0lIwDNCA2lE2YB4yHMSBSRU0gb3BfNC50eHQKMiBSRU0gaW5wdXQ6IDQgNgozIFJFTSBhc2Zlc2tlamZld2Y0IElOUFVUIHgsIHkKNSBFWElUICgoKHggKyAgeSkgICogeSkgLSB4ICogeSkgKiAoKHggLSB5KSArICh5ICAtIHgpICogKHggKyAoeSAqIHgpKSkKlHSUKIwIb3BfNS50eHSUjAM0IDaUSxOM0TEgUkVNIG9wXzUudHh0CjIgUkVNIGlucHV0OiA0IDYKMyBSRU0gYXNmZXNrZWpmZXdmNCBJTlBVVCBuLCBtCjUgTEVUIGkgPSAwCjYgTEVUIHN1bSA9IDAKNyBGT1IgaSA9IGkgKyAxOyAoaSA8PSA1KSAmJiAoaSA8IG4gKiAobiAqIG0gLSBtKSAtIG4gKiBtIC0gbikKOCBMRVQgc3VtID0gc3VtICsgaSAqIGkKOSBFTkQgRk9SCjEwIEVYSVQgc3VtIC0gKGkgKiA2KQoKlHSUKIwIb3BfNi50eHSUjAM4IDaUSwGMkjEgUkVNIG9wXzYudHh0CjIgUkVNIGlucHV0OiA4IDYKMyBSRU0gYXNmZXNrZWpmZXdmNCBJTlBVVCBhLCBiCjUgSUYgYSA+PSBiICYmIGEgLSAxICE9IGIgVEhFTiA4CjYgTEVUIGMgPSBiIC8gYQo3IEdPVE8gOQo4IExFVCBjID0gYSAqIGIKOSBFWElUIGMKlHSUKIwIb3BfNy50eHSUjAIxMJRLBIyCMSBSRU0gb3BfNy50eHQKMiBSRU0gaW5wdXQ6IDEwCjMgUkVNIGFzZmVza2VqZmV3ZjQgSU5QVVQgbiAKNSBMRVQgaSA9IDEKNiBGT1IgaSA9IGkgKyAxOyBpIDwgbgo3IExFVCBuID0gbiAtIGkKOCBFTkQgRk9SCjkgRVhJVCBuCpR0lCiMCG9wXzgudHh0lIwDMyA2lEsBjG0xIFJFTSBvcF84LnR4dAoyIFJFTSBpbnB1dDogMyA2IAozIFJFTSBhc2Zlc2tlamZld2Y0IElOUFVUIG0sIG4KNSBMRVQgZXhpdCA9IG0vMiArIChuLzIgLSBtKSAqIDUKNiBFWElUIGV4aXQKlHSUKIwIb3BfOS50eHSUjAQ4IDEwlEsEjLgxIFJFTSBvcF85LnR4dAoyIFJFTSBpbnB1dDogOCAxMAozIFJFTSBhc2Zlc2tlamZld2Y0IElOUFVUIG0sbgo1IElGIG0gPj0gbiBUSEVOIDgKNiBJRiBtIDwgbiAtIDIgfHwgbSA9PSBuIC0gMiBUSEVOIDEwCjcgR09UTyA5CjggTEVUIG0gPSBtIC0gbgo5IEVYSVQgbQoxMCBMRVQgbSA9IG4gKyAyIC0gbQoxMSBHT1RPIDkKlHSUKIwJb3BfMTAudHh0lIwHNyA4IDIgM5RLDIyiMSBSRU0gb3BfMTAudHh0CjIgUkVNIGlucHV0OiA3IDggMiAzCjMgUkVNIGFzZmVza2VqZmV3ZjQgSU5QVVQgbSwgbiwgcCwgcQo1IExFVCB4ID0gKG0gKyBuKS9wICsgKG0gKyBuKS8gcQo2IExFVCB5ID0geCAqIDIgLSAobSArIG4pICogKHAgKyBxKSAvIChwICogcSkKNyBFWElUIHkKlHSUZS4="

test_cases = pickle.loads(base64.b64decode(testdata.encode()))
info('Test cases count: {}'.format(len(test_cases)))
if len(YOUR_BASEPATH) == 0:
    fatal('Base path error.')

for i in test_cases:
    result = judge(i)
    if not result:
        print('TEST FAILED')
        # sys.exit(0)

print('PASSED ALL')